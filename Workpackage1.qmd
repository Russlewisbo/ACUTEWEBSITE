---
title: "Workpackage 1"
date: "11/2/2022"
format: 
  html:
    code-fold: true
execute:
  echo: true
  warning: false
  freeze: false
bibliography: references.bib
csl: nature.csl
---

## Workpackage 1A: <br>Quantitative Relationship of Tpos with Numbers of Viable Gram-Negative Bacteria

### Methods

In this package we will establishing the quantitative relationship of Tpos and KPC- cabrapenemase producing *Klebsiella pneumoniae* inoculum in blood culture bottles. <br> The methods for the assay are a modification of those originally proposed by Kaltsas et al.[@kaltsas2005] Detailed procedures can be found at this [link](Protocols.html). Methodology for preparing the test inoculum was adapted from [CLSI M21A](CLSI_M21A.pdf) and [M26A](CLSI_M26A.pdf) guidelines.[@Clinical_Laboratory_Standards_Institute1999-iy; @Clinical_Laboratory_Standards_Institute1999-iya]

-   Briefly, tubes containing 1.8 mL of pooled healthy human serum are inoculated with 0.2 mL of a series of ten-fold dilutions (5x10^1^ to 5x10^7^ CFU/mL) of the standardised inoculum of each test indicator strains.
-   The sera were are then transferred into BacT⁄ALERT bottles ***without antibiotic inactivating matrix*** (Biomérieux Inc) for aerobic incubation for 24 hours and monitored for time to positivity.
-   Tpos results were used to establish preliminary assay quality control ranges by testing in triplicate for five KPC-carbapenemase producing *K. pneumoniae* strains (KPC A, B and C strains; NDM, and VIM producing strains) and a reference *K. pneumoniae* ATCC strain producing ESBL enzyme only. More detailed information on the isolates can be found on the [Protocols](Protocols.html) section.
-   We also compared how Tpos results change if the organism suspension prepared in phosphate buffered saline (PBS-0.9%) versus pooled human serum (serum).

### Results

The relationship between Tpos and the *K. pneumoniae* inoculum is shown in [@fig-1] a linear relationship was observed from approximately 10^1^-10^8^ *K. pneumoniae* CFU/mL and a Tpos measured from 10.5 hours-4.5 hours over the tested inoculum range, with R^2^ of 0.92-0.94. The linear relationship of Tpos versus inoculum was consistent if the inoculum was prepared in PBS or pooled human serum as shown in [@tbl-1].

::: callout-note
In the original methodology proposed by Kaltsas et al, [@kaltsas2005] the isolate inoculum was reported as the inoculum introduced into the bottle, which already contains between 30-40 mL of growth media (depending on the manufacturer).

Therefore we have followed this precedent of reporting the inoculum introduced into each bottle. This does not represent the final test inoculum that need to account for the total 42 mL volume in each bloodculture bottle.

All experiments were performed using bloodculture bottles ***without antibiotic inactivating matrix***
:::

```{r}
#| label: fig-1
#| fig-cap: "Relationship of time-to-positivity (Tpos) versus test inoculum"


library (ggplot2)
library(scales)
theme_set(theme_bw())
## import raw data from .csv file
wp1 <- read.csv("~/Desktop/ACUTEWEBSITE/wp1a.csv")
## plot raw data as x-y graph Tpos graph vs. drug concentrations stratified by dilution matrix, method="lm" is the method for linear regression
fig1 <-ggplot(wp1, aes(x=inoculum, y=tpos, color=isolates, shape=diluent, fill=isolates)) + geom_point(size=4, alpha = 0.5) + 
scale_y_continuous(name="Tpos (hr)", limits=c(4,12)) +
theme(legend.text=element_text(size=12)) +
geom_smooth(aes(linetype=diluent), method=lm , color="black", fill="#69b3a2", se=TRUE, inherit.aes = TRUE )
fig1 + theme_bw(base_size = 14)+ scale_x_log10(name="Inoculum CFU/mL", breaks = trans_breaks("log10",n=7, function(x) 10^x),labels = trans_format("log10", math_format(10^.x)))

```

```{r}
#| label: tbl-1
#| tbl-cap: Effect of inoculum diluent on Tpos
library(forestmangr)
library(kableExtra)
wp1 <- read.csv("~/Desktop/ACUTEWEBSITE/wp1a.csv")
df <- data.frame (wp1)
table1<-lm_table(df, log(inoculum) ~ tpos, "diluent")
kbl(table1)%>%
kable_paper("hover", full_width = F, position="left")
```

::: callout-note
## These data confirm that Tpos exhibits a wide dynamic range as a surrogate indicator for viable CFU/mL.
:::

------------------------------------------------------------------------

## Workpackage 1B: <br> Effect of ceftazidime/avibactam exposure on Tpos

This workpackage explores how ceftazidime/avibactam concentrations, alone or in combination with other antibiotics alters Tpos for a standard bacterial inoculum of 1x10^4^ CFU/mL of *Klebsiella pneumoniae*. <br>

### Methods

The effect of increasing fixed ceftazidime/avibactam (CAZ/AVI) concentrations (4:1) on Tpos was investigated at an inoculum of 1x10^4^ CFU/mL of *K. pneumoniae* KPC_B (MIC 1 mg/L) and *K. pneumoniae* NDM producing isolate (negative control) [@tbl-table2]. All experiments were performed in \> 5 replicates with an incubation period of 24 hours.

### Results

As shown in [@fig-2], a marked increased in the Tpos for KPC_B from \< 10 hrs to [\>]{.underline} 24 hrs when CAZ/AVI concentrations surpassed 1 mg/L. In contrast, the negative control KPC_NDM strain exhibited consistent Tpos \< 10hr at all test concentrations with lack of antimicrobial activity. Trends in Tpos relative to antibiotic exposure were fitted by Loess.

::: callout-note
Drug concentrations reported in figures represent the concentration of antibiotic injected (1 mL) into the bottle- "simulating" the antibiotic concentrations that would be detected in the bloodstream. These concentrations do not account for 40 mL growth median and inoculum (1 mL) already present in the bottle= total volume 42 mL.
:::

```{r}
#| label: fig-2
#| fig-cap: "Effect of ceftazidime/aviactam concentrations on Tpos of K. pneumoniae"

library (ggplot2)
theme_set(theme_bw())
ceftaz <- read.csv("~/Desktop/ACUTEWEBSITE/datasets/ceftazidime.csv")
ggplot(ceftaz, aes(x=conc, y=tpos, color=isolate, shape=isolate)) + 
  geom_point(size=4, alpha = 0.7)+ 
  geom_smooth(aes(linetype=isolate), method= loess, color="black", fill="#69b3a2", se=TRUE, inherit.aes = TRUE ) +
scale_x_log10(name="CAZ/AVI, mg/L") +
scale_y_continuous(name="Tpos (hr)", limits=c(4,25)) 

```

| Isolate                        | Carbapenemase enzyme | Ceftazidime/avibactam Etest MIC (mg/L) |
|-----------------------------|-------------------|------------------------|
| *Klebsiella pneumoniae* KPC- B | KPC-3                | 1                                      |
| *Klebsiella pneumoniae* NDM    | NDM-2                | \>64                                   |

: Isolates used for testing {#tbl-table2}

#### KPC B isolate (MIC 1 mg/L) tested with commercial pharmaceutical formulation

-   The relationship between ceftazidime/avibactam concentrations and Tpos were analyzed by testing increasing concentrations of ceftazidime (0-8 mg/L) and avibactam (fixed ratio 4:1) using the commercial Avycaz (Zavicefta) formulation in at least 5 replicate experiments performed on separate days.
-   Bottles were incubated with 1x10^4^ *Klebsiella pneumoniae* KPC-B strain and incubated at 37°C for 24 hours. Tpos positivity was registered using the BACTEC Alert/3D software
-   Tpos data versus ceftazidime/avibactam concentrations were then fit to a 4-parameter logistic regression model using the Dose-Response Data Analysis (DRDA) package to estimate PD endpoints.[@drda] Regression results were extracted using the Broom [@broom] and Kableextra [@kableExtra] packages.
-   Results of the pharmacodynamic analysis are shown in [@fig-3]. Ceftazidime/avibactam exhibited a steep Tpos response from and EC~50~ of 2.10 (95% CI 2.08-2.12) to and EC~90~ 2.39 (2.33-2.45). As shown in [@tbl-3], the transitional portion of the dose-response curve occurred 1-dilution above the MIC (1 mg/L) that was determined by Etest.

::: callout-note
Experiments shown in [@fig-3] were performed using commercial CAZ/AVI pharmaceutical formulation not analytical powder. Concentrations plotted on the X axis indicate concentrations of ceftazidime (4:1 relative to avibactam) in tubes
:::

```{r }
#| label: fig-3
#| fig-cap: "Pharmacodynamic relationship of Tpos to ceftazidime/avibactam concentrations"

## a four-parameter logistic regression model is fit to ceftazidime concentrations to estimated PD parameters
library (readxl)
library(drda)
caz_avi_4 <- read_excel("datasets/kpcb_caz_avi_com.xlsx")
fit1 <- drda(tpos ~ ctz, data=caz_avi_4, mean_function = "loglogistic4", max_iter = 1000)
plot(fit1, xlab = "CAZ/AVI Serum (mg/L)", ylab = "Tpos (hr)")
```

```{r}
#| label: tbl-3
#| tbl-cap: "Pharmacodynamic estimates"


## Analysis is repeated to produce a table reporting estimated EC10-EC95 parameter estimates plus 95% CI 
library (readxl)
library(drda)
library(broom)
library(kableExtra)
caz_avi_4 <- read_excel("datasets/kpcb_caz_avi_com.xlsx")
fit1 <- drda(tpos ~ ctz, data=caz_avi_4, mean_function = "loglogistic4", max_iter = 1000)
ed<-effective_dose(fit1, y = c(0.10,0.25,0.50,0.75,0.90,0.95))
kbl(ed)%>%
kable_paper("hover", full_width = F, position = "left")
```

### Inoculum effects on ceftazidime/avibactam targets with commercial pharmaceutical formulation

#### KPC B isolate (MIC 1 mg/L)

```{r }
#| label: fig-3a
#| fig-cap: "Pharmacodynamic relationship of Tpos to ceftazidime/avibactam concentrations against a high-inoculum"

## a four-parameter logistic regression model is fit to ceftazidime concentrations to estimated PD parameters
library (readxl)
library(drda)
caz_avi_4 <- read_excel("datasets/kpcb_caz_avi_com_hinoc.xlsx")
fit1 <- drda(tpos ~ ctz, data=caz_avi_4, mean_function = "loglogistic4", max_iter = 1000)
plot(fit1, xlab = "CAZ/AVI Serum (mg/L)", ylab = "Tpos (hr)")
```

```{r}
#| label: tbl-3a
#| tbl-cap: "Pharmacodynamic estimates for a high-inoculum"


## Analysis is repeated to produce a table reporting estimated EC10-EC95 parameter estimates plus 95% CI 
library (readxl)
library(drda)
library(broom)
library(kableExtra)
caz_avi_4 <- read_excel("datasets/kpcb_caz_avi_com_hinoc.xlsx")
fit1 <- drda(tpos ~ ctz, data=caz_avi_4, mean_function = "loglogistic4", max_iter = 1000)
ed<-effective_dose(fit1, y = c(0.10,0.25,0.50,0.75,0.90,0.95))
kbl(ed)%>%
kable_paper("hover", full_width = F, position = "left")
```

<br>

#### KPC B isolate (MIC 1 mg/L) tested with analytical powder

-   The relationship between ceftazidime/avibactam concentrations and Tpos were repeated by testing increasing concentrations of ceftazidime (0-8 mg/L) and avibactam (fixed ratio 4:1) *using the analytical grade powder instead of the commercial pharmaceutical formulation.* Experiments were performed in at least 5 replicate experiments on separate days.
-   Bottles were incubated with 1x10^4^ *Klebsiella pneumoniae* KPC-B strain and incubated at 37°C for 24 hours. Tpos positivity was registered using the BACTEC Alert/3D software
-   Tpos data versus ceftazidime/avibactam concentrations were then fit to a 4-parameter logistic regression model using the Dose-Response Data Analysis (DRDA) package to estimate PD endpoints.[@drda] Regression results were extracted using the Broom [@broom] and Kableextra [@kableExtra] packages.
-   As shown in [@fig-4], ceftazidime/avibactam exhibited a steep Tpos response with increasing concentrations with an EC~50~ of 2.10 (95% CI 2.08-2.12) to and EC~90~ 2.39 (2.33-2.45). The transitional portion of the dose-response curve occurred 1-dilution above the MIC (1 mg/L) determined using Etest strips [@tbl-4].

<br>

::: callout-note
Experiments shown in [@fig-4] were performed using CAZ/AVI *analytical grade powder* at a fixed 4:1 ratio. Concentrations plotted on the X axis indicate concentrations of ceftazidime (4:1 relative to avibactam) in tubes
:::

```{r }
#| label: fig-4
#| fig-cap: "Pharmacodynamic relationship of Tpos to ceftazidime/avibactam concentrations"

## a four-parameter logistic regression model is fit to ceftazidime concentrations to estimated PD parameters
library (readxl)
library(drda)
caz_avi_4 <- read_excel("datasets/kpcb_caz_avi_powder_4-1.xlsx")
fit1 <- drda(tpos ~ ctz, data=caz_avi_4, mean_function = "loglogistic4", max_iter = 1000)
plot(fit1, xlab = "CAZ/AVI serum (mg/L)", ylab = "Tpos (hr)")
```

```{r}
#| label: tbl-4
#| tbl-cap: "Pharmacodynamic estimates"


## Analysis is repeated to produce a table reporting estimated EC10-EC95 parameter estiamtes plus 95% CI 
library (readxl)
library(drda)
library(broom)
library(kableExtra)
caz_avi_4 <- read_excel("datasets/kpcb_caz_avi_powder_4-1.xlsx")
fit1 <- drda(tpos ~ ctz, data=caz_avi_4, mean_function = "loglogistic4", max_iter = 1000)
ed<-effective_dose(fit1, y = c(0.10,0.25,0.50,0.75,0.90,0.95))
kbl(ed)%>%
kable_paper("hover", full_width = F, position = "left")
```

------------------------------------------------------------------------

#### KPC A isolate (MIC 2 mg/L) tested with commercial formulation

-   Experiments with the commercial and analytical powder forms of ceftazidime/avibactam were repeated substituting *Klebsiella pneumoniae* KPC A isolate (ceftazidime/avibactam MIC 2 mg/L).

-   Results of the logistic regression analysis from studies with the commercial formulation demonstrated an EC~50~ 4.14 mg/L (95% CI4.09-4.20) and an EC~90~ 4.78 (95% CI 4.59-4.96) as shown in [@fig-5]. The transitional portion of the dose response curve occurred 1-dilution above the MIC of the isolate (2 mg/L) determined by Etest [@tbl-5].

::: callout-note
Experiments plotted in [@fig-5] were performed using the commercial CAZ/AVI pharmaceutical formulation for *K. pneumoniae* KPC producing isolate A (MIC 2 mg/L)
:::

```{r}
#| label: fig-5
#| fig-cap: "Pharmacodynamic relationship of Tpos to ceftazidime/avibactam concentrations"

## a four-parameter logistic regression model is fit to ceftazidime concencentrations to estiamted PD parameters
library (readxl)
library(drda)
caz_avi_6 <- read_excel("datasets/kpca_caz_avi_com.xlsx")
fit3 <- drda(tpos ~ ctz, data=caz_avi_6, mean_function = "loglogistic4", max_iter = 1000)
plot(fit3, xlab = "CAZ/AVI serum (mg/L)", ylab = "Tpos (hr)")

```

```{r}
#| label: tbl-5
#| tbl-cap: "Pharmacodynamic estimates"

## Analysis is repeated to produce a table reporting estimated EC10-EC95 parametersestiamtes plus 95% CI 
library (readxl)
library(drda)
library(broom)
library(kableExtra)
caz_avi_6 <- read_excel("datasets/kpca_caz_avi_com.xlsx")
fit3 <- drda(tpos ~ ctz, data=caz_avi_6, mean_function = "loglogistic4", max_iter = 1000)
ed<-effective_dose(fit3, y = c(0.10,0.25,0.50,0.75,0.90,0.95))
kbl(ed)%>%
kable_paper("hover", full_width = F, position = "left")
```

<br>

#### KPC A isolate (MIC 2 mg/L) tested with analytical powder

-   Similar experiments were performed using the same methodology and **analytical grade powder of ceftazidime-avibactam formulation (fixed 4:1 ratio)** against *Klebsiella pneumoniae* KPC A isolate (ceftazidime/avibactam MIC 2 mg/L).

-   Results of the logistic regression are shown in [@fig-6] and demonstrated an EC~50~ 4.55 mg/L (95% CI4.29-4.83) and an EC~90~ 6.89 (95% CI 5.71-8.08) shown in [@tbl-6]. The transitional portion of the dose response curve was relatively broader and occurred 1-3 dilutions above the MIC of the isolate (2 mg/L) determined by Etest.

::: callout-note
Experiments reported in [@fig-6] performed using pure powder at a CAZ:AVI ratio of 4:1
:::

```{r}
#| label: fig-6
#| fig-cap: "Pharmacodynamic relationship of Tpos to ceftazidime/avibactam concentrations"

library (readxl)
library(drda)
caz_avi_5 <- read_excel("datasets/kpca_caz_avi_powder_4-1.xlsx")
fit2 <- drda(tpos ~ ctz, data=caz_avi_5, mean_function = "loglogistic4", max_iter = 1000)
plot(fit2, xlab = "CAZ/AVI serum (mg/L)", ylab = "Tpos (hr)")
```

```{r}
#| label: tbl-6
#| tbl-cap: "Pharmacodynamic relationship of Tpos to ceftazidime/avibactam concentrations"


## Analysis is repeated to produce a table reporting estimated EC10-EC95 parametersestiamtes plus 95% CI 
library (readxl)
library(drda)
library(broom)
library(kableExtra)
caz_avi_5 <- read_excel("datasets/kpca_caz_avi_powder_4-1.xlsx")
fit2 <- drda(tpos ~ ctz, data=caz_avi_5, mean_function = "loglogistic4", max_iter = 1000)
ed<-effective_dose(fit2, y = c(0.10,0.25,0.50,0.75,0.90,0.95))
kbl(ed)%>%
kable_paper("hover", full_width = F, position = "left")
```

<br>

------------------------------------------------------------------------

### Impact of testing fixed avibactam concentrations on pharmacodynamic estimates

#### KPC A isolate (MIC 2 mg/L)

-   We further explored how the results would change if a single fixed concentration of avibactam (4 mg/L) was used in all tubes. Experiments were performed as described previously using the same method and the analytical-grade powder of ceftazidime-avibactam formulation with at fixed avibactam concentrations against *Klebsiella pneumoniae* KPC B isolate (ceftazidime/avibactam MIC 1 mg/L).

-   Results of the logistic regression are shown in [@fig-7] demonstrated a lower EC~50~ 4.14 mg/L (95% CI 4.09-4.19 ) and an EC~90~ 4.77 (95% CI 4.59-4.96) as shown in [@tbl-7]. The transitional portion of the dose response curve was relatively broader but occurred 1-3 dilutions near the MIC of the isolate (2 mg/L) determined by Etest.

::: callout-note
Experiments performed in [@fig-7] utilized pure powder with a fixed avibactam concentration of 4 mg/L in all ceftazidime containing bottles.
:::

```{r}
#| label: fig-7
#| fig-cap: "Pharmacodynamic relationship of Tpos to ceftazidime/avibactam concentrations"

## a four-parameter logistic regression model is fit to ceftazidime concentrations to estimated PD parameters
library (readxl)
library(drda)
caz_avi_7 <- read_excel("datasets/kpca_caz_avi_powder_fix4.xlsx")
fit4 <- drda(tpos ~ ctz, data=caz_avi_7, mean_function = "loglogistic4", max_iter = 1000)
plot(fit4, xlab = "CAZ/AVI serum (mg/L)", ylab = "Tpos (hr)")

```

```{r}
#| label: tbl-7 
#| tbl-cap: "Pharmacodynamic estimates"

## Analysis is repeated to produce a table reporting estimated EC10-EC95 parametersestiamtes plus 95% CI 
library (readxl)
library(drda)
library(broom)
library(kableExtra)
caz_avi_7 <- read_excel("datasets/kpca_caz_avi_powder_fix4.xlsx")
fit4 <- drda(tpos ~ ctz, data=caz_avi_7, mean_function = "loglogistic4", max_iter = 1000)
ed<-effective_dose(fit4, y = c(0.10,0.25,0.50,0.75,0.90,0.95))
kbl(ed)%>%
kable_paper("hover", full_width = F, position = "left")
```

<br>

#### KPC B isolate (MIC 1 mg/L)

-   Similar experiments were repeated with the *Klebsiella pneumoniae* KPC B isolate (ceftazidime/avibactam MIC 1 mg/L).

-   Results of the logistic regression are shown in [@fig-8] and demonstrated a lower EC~50~ 1.28 mg/L (95% CI 1.18-1.38) and an EC~90~ 2.66 (95% CI 1.87-3.44) shown in [@tbl-8]. The transitional portion of the dose response curve was relatively broader but occurred 1-3 dilutions near the MIC of the isolate (1 mg/L) determined by Etest.

::: callout-note
Experiments shown in [@fig-8] were repeated using pure powder but with a fixed concentration of avibactam at 4 mg/L in all tubes
:::

```{r}
#| label: fig-8
#| fig-cap: "Pharmacodynamic relationship of Tpos to ceftazidime/avibactam concentrations"

## a four-parameter logistic regression model is fit to ceftazidime concentrations to estimated PD parameters
library (readxl)
library(drda)
caz_avi_8 <- read_excel("datasets/kpcb_caz_avi_powder_fix4.xlsx")
fit5<- drda(tpos ~ ctz, data=caz_avi_8, mean_function = "loglogistic4", max_iter = 1000)
plot(fit5, xlab = "CAZ/AVI serum (mg/L)", ylab = "Tpos (hr)")

```

```{r}
#| label: tbl-8
#| tbl-cap: "Pharmacodynamic estimates"

## Analysis is repeated to produce a table reporting estimated EC10-EC95 parametersestiamtes plus 95% CI 
library (readxl)
library(drda)
library(broom)
library(kableExtra)
caz_avi_8 <- read_excel("datasets/kpcb_caz_avi_powder_fix4.xlsx")
fit5 <- drda(tpos ~ ctz, data=caz_avi_8, mean_function = "loglogistic4", max_iter = 1000)
ed<-effective_dose(fit5, y = c(0.10,0.25,0.50,0.75,0.90,0.95))
kbl(ed)%>%
kable_paper("hover", full_width = F, position = "left")
```

::: callout-note
## Overall these data show Tpos is a robust PD endpoint and the relationship of ceftazidime/avibactam concentrations versus Tpos follows classical sigmoidal dose response relationship with a steep transitional portion of the dose response curve that occurs near the MIC of the pathogen.Although ED50/90 estimates were broadly similar if the commercial (pharmaceutical) and analytical powder formulations were tested, used of high-fixed concentrations of avibactam or testing at very high K. pneumoniae inocula resulted in broader concentration-effect curves and higher EC50/90 estimates
:::

------------------------------------------------------------------------

### Meropenem

#### ATCC isolate (MIC )

-   The impact of increasing meropenem concentrations on Tpos observed with the ATCC ESBL producing *Klebsiella pneumoniae* was tested using similar methodology as previously described

-   Analytical powder was used to produce serum concentration

-   As shown in [@fig-9] , Tpos increased as meropenem concentrations surpassed the MIC, with an estimated pharmacodynamic parameters consistent with previous experiments that showed transition in the EC50/EC90 at simulated serum concentrations near the MIC as shown in [@tbl-9].

```{r}
#| label: fig-9
#| fig-cap: "Pharmacodynamic relationship of Tpos to meropenem concentrations"

## a four-parameter logistic regression model is fit to meropenem concentrations to estimated PD parameters
library (readxl)
library(drda)
mero1 <- read_excel("datasets/ATCC_meropenem.xlsx")
fit6 <- drda(tpos ~ mero, data=mero1, mean_function = "loglogistic4", max_iter = 1000)
plot(fit6, xlab = "Meropenem serum (mg/L)", ylab = "Tpos (hr)")

```

```{r}
#| label: tbl-9
#| tbl-cap: "Pharmacodynamic estimates"

## Analysis is repeated to produce a table reporting estimated EC10-EC95 parameter estimates plus 95% CI 
library (readxl)
library(drda)
library(broom)
library(kableExtra)
mero1 <- read_excel("datasets/ATCC_meropenem.xlsx")
fit6 <- drda(tpos ~ mero, data=mero1, mean_function = "loglogistic4", max_iter = 1000)
ed<-effective_dose(fit6, y = c(0.10,0.25,0.50,0.75,0.90,0.95))
kbl(ed)%>%
kable_paper("hover", full_width = F, position = "left")
```

#### KPC B isolate (MIC )

```{r}
#| label: fig-9b
#| fig-cap: "Pharmacodynamic relationship of Tpos to gentamicin concentrations"

## a four-parameter logistic regression model is fit to meropenem concentrations to estimated PD parameters
library (readxl)
library(drda)
mero2 <- read_excel("datasets/KPCB_meropenem.xlsx")
fit7 <- drda(tpos ~ mero, data=mero2, mean_function = "loglogistic4", max_iter = 1000)
plot(fit7, xlab = "Meropenem serum (mg/L)", ylab = "Tpos (hr)")

```

```{r}
#| label: tbl-9b
#| tbl-cap: "Pharmacodynamic estimates"

## Analysis is repeated to produce a table reporting estimated EC10-EC95 parameter estimates plus 95% CI 
library (readxl)
library(drda)
library(broom)
library(kableExtra)
mero1 <- read_excel("datasets/KPCB_meropenem.xlsx")
fit7 <- drda(tpos ~ mero, data=mero2, mean_function = "loglogistic4", max_iter = 1000)
ed<-effective_dose(fit7, y = c(0.10,0.25,0.50,0.75,0.90,0.95))
kbl(ed)%>%
kable_paper("hover", full_width = F, position = "left")
```

------------------------------------------------------------------------

### Gentamicin

#### KPC A isolate (MIC 2 mg/L)

```{r}
#| label: fig-genta
#| fig-cap: "Pharmacodynamic relationship of Tpos to gentamicin concentrations"

## a four-parameter logistic regression model is fit to gentamicin concentrations to estimated PD parameters
library (readxl)
library(drda)
gent1 <- read_excel("datasets/KPCA_gent.xlsx")
fit8 <- drda(tpos ~ gent, data=gent1, mean_function = "loglogistic4", max_iter = 1000)
plot(fit8, xlab = "Gentamicin serum (mg/L)", ylab = "Tpos (hr)")

```

```{r}
#| label: tbl-genta
#| tbl-cap: "Pharmacodynamic estimates"

## Analysis is repeated to produce a table reporting estimated EC10-EC95 parameter estimates plus 95% CI 
library (readxl)
library(drda)
library(broom)
library(kableExtra)
gent1 <- read_excel("datasets/KPCA_gent.xlsx")
fit8 <- drda(tpos ~ gent, data=gent1, mean_function = "loglogistic4", max_iter = 1000)
ed<-effective_dose(fit8, y = c(0.10,0.25,0.50,0.75,0.90,0.95))
kbl(ed)%>%
kable_paper("hover", full_width = F, position = "left")
```

#### KPC B isolate (MIC 0.5 mg/L )

```{r}
#| label: fig-gentb
#| fig-cap: "Pharmacodynamic relationship of Tpos to meropenem concentrations"

## a four-parameter logistic regression model is fit to meropenem concentrations to estimated PD parameters
library (readxl)
library(drda)
gent2 <- read_excel("datasets/KPCB_gent.xlsx")
fit9 <- drda(tpos ~ gent, data=gent2, mean_function = "loglogistic4", max_iter = 1000)
plot(fit9, xlab = "Gentamicin serum (mg/L)", ylab = "Tpos (hr)")

```

```{r}
#| label: tbl-gentb
#| tbl-cap: "Pharmacodynamic estimates"

## Analysis is repeated to produce a table reporting estimated EC10-EC95 parameter estimates plus 95% CI 
library (readxl)
library(drda)
library(broom)
library(kableExtra)
gent2 <- read_excel("datasets/KPCB_gent.xlsx")
fit9 <- drda(tpos ~ gent, data=gent2, mean_function = "loglogistic4", max_iter = 1000)
ed<-effective_dose(fit9, y = c(0.10,0.25,0.50,0.75,0.90,0.95))
kbl(ed)%>%
kable_paper("hover", full_width = F, position = "left")
```

<br>

------------------------------------------------------------------------

### Colistin

#### KPC B isolate (MIC 0.125 mg/L)

```{r}
#| label: fig-colib
#| fig-cap: "Pharmacodynamic relationship of Tpos to colistin concentrations"

## a four-parameter logistic regression model is fit to colistin concentrations to estimated PD parameters
library (readxl)
library(drda)
coli1 <- read_excel("datasets/KPCB_coli.xlsx")
fit10 <- drda(tpos ~ coli, data=coli1, mean_function = "loglogistic4", max_iter = 1000)
plot(fit10, xlab = "Colistin serum (mg/L)", ylab = "Tpos (hr)")

```

```{r}
#| label: tbl-colib
#| tbl-cap: "Pharmacodynamic estimates"

## Analysis is repeated to produce a table reporting estimated EC10-EC95 parameter estimates plus 95% CI 
library (readxl)
library(drda)
library(broom)
library(kableExtra)
coli1 <- read_excel("datasets/KPCB_coli.xlsx")
fit10 <- drda(tpos ~ coli, data=coli1, mean_function = "loglogistic4", max_iter = 1000)
ed<-effective_dose(fit10, y = c(0.10,0.25,0.50,0.75,0.90,0.95))
kbl(ed)%>%
kable_paper("hover", full_width = F, position = "left")
```

------------------------------------------------------------------------

### Meropenem-vaborbactam

```{r}
#| label: fig-vabob
#| fig-cap: "Pharmacodynamic relationship of Tpos to meropenem-vaborbactam concentrations"

## a four-parameter logistic regression model is fit to meropenem-vaborbactam concentrations to estimated PD parameters
library (readxl)
library(drda)
vabo1 <- read_excel("datasets/KPCB_vabo.xlsx")
fit11 <- drda(tpos ~ vabo, data=vabo1, mean_function = "loglogistic4", max_iter = 1000)
plot(fit11, xlab = "Meropenem-vabobactam serum (mg/L)", ylab = "Tpos (hr)")

```

```{r}
#| label: tbl-vabob
#| tbl-cap: "Pharmacodynamic estimates"

## Analysis is repeated to produce a table reporting estimated EC10-EC95 parameter estimates plus 95% CI 
library (readxl)
library(drda)
library(broom)
library(kableExtra)
vabo1 <- read_excel("datasets/KPCB_vabo.xlsx")
fit11 <- drda(tpos ~ vabo, data=vabo1, mean_function = "loglogistic4", max_iter = 1000)
ed<-effective_dose(fit11, y = c(0.10,0.25,0.50,0.75,0.90,0.95))
kbl(ed)%>%
kable_paper("hover", full_width = F, position = "left")
```

------------------------------------------------------------------------

## Workpackage 1C: <br>Effect of combination antimicrobial exposure on Tpos

### Methods

-   The activity of combination ceftazidime/avibactam (4 to 1 ratio from commercial formulation) plus gentamicin (0-4 mg/L) was tested against *Klebsiella pneumonia* KPCB strain in 5 replicate experiments using an array of test concentrations.

    ![Test array](test_array.png){width="500"}

-   The effect of the antibiotic combinations Tpos combination was analyzed using a Bliss Independence Model of drug interaction using a workflow described for the [synergy analysis](https://cran.r-project.org/web/packages/BIGL/vignettes/analysis.html) using the BIGL package.[@BIGL]

-   The first step of the fitting procedure analyzed marginal data only, i.e. those observations within the experiment where one of the compounds is dosed at zero. For each compound the corresponding marginal doses are modelled using a 4-parameter logistic model

-   The marginal models will be estimated together using non-linear least squares estimation procedure. A simple sum-of-squared-residuals minimization driven by a default Nelder-Mead algorithm from `optim` minimizer was used.

-   Presence of synergistic or antagonistic effects was formalized by means of the meanR and maxR test. `meanR` test evaluates how the predicted response surface based on a specified null model differs from the observed one. If the null hypothesis is rejected, this test suggests that at least some dose combinations may exhibit synergistic or antagonistic behaviour. The `meanR` test is not designed to pinpoint which combinations produce these effects nor what type of deviating effect is present.

-   `maxR` test allows to evaluate presence of synergistic/antagonistic effects for each dose combination and as such provides a point-by-point classification.

### Results

### Ceftazidime-avibactam + gentamicin

-   The results shown in [@fig-10] demonstrated that CTZ/AVI + gentamicin is broadly synergistic over the range of tested concentrations, with and average 4.29 hr increase (95% CI 2.65-6.46) in Tpos versus the predicted null interactive response of ceftazidime-avibactam and gentamicin alone.

```{r}
#| label: fig-10
#| fig-cap: "Effect of combined ceftazidime/avibactam and gentamicin effects on Tpos"

library(BIGL)
library(knitr)
library(rgl)
library(ggplot2)
library(broom)
library(kableExtra)
set.seed(12345)
cutoff <- 0.95
caz_gent_kpcb2 <- read.csv("~/Desktop/ACUTEWEBSITE/datasets/caz_gent_kpcb2.csv")
## Fitting marginal models, maximal fixed at 24 hours, minimal at 9.5 hours
marginalFit <- fitMarginals(caz_gent_kpcb2, method = "optim",                 
                            fixed = c("m1" = 24, "m2" = 24, "b" = 9.5),
                            names = c("CTZ/AVI", "GENT"))
summary(marginalFit)
## Plotting marginal model for ceftazidime and gentamicin, minimum constrained at 9 hrs and maximum contrastined at 24 hours
plot(marginalFit) + ggtitle(paste("Ceftazidime/Avibactam + Gentamicin"))
rs <- fitSurface(caz_gent_kpcb2, marginalFit,
                 null_model = "bliss",
                 B.CP = 50, statistic = "none", parallel = FALSE)
summary(rs)
plot(rs, legend = FALSE, main = "")
view3d(0, -75)
rglwidget()


## mean R statistic evaluates how the test evaluates how the predicted response surface based on a specified null model differs from the observed one. If the null hypothesis is rejected, this test suggests that at least some dose combinations may exhibit synergistic or antagonistic behaviour. The meanR test is not designed to pinpoint which combinations produce these effects nor what type of deviating effect is present.
meanR_N <-fitSurface(caz_gent_kpcb2, marginalFit, statistic="meanR",CP=rs$CP, B.B=20, parallel = FALSE)

# maxR test allows to evaluate presence of synergistic/antagonistic effects for each dose combination and as such provides a point-by-point classification.
maxR_N <- fitSurface(caz_gent_kpcb2, marginalFit,
                     statistic = "maxR", CP = rs$CP, B.B = 20,
                     parallel = FALSE)
maxR_B <- fitSurface(caz_gent_kpcb2, marginalFit,
                     statistic = "maxR", CP = rs$CP, B.B = 20,
                     parallel = FALSE)
maxR_both <- rbind(summary(maxR_N$maxR)$totals,
                   summary(maxR_B$maxR)$totals)

contour(maxR_B,
         ## colorPalette = c("blue", "black", "black", "red"),
        main = paste0(" Ceftazidime/Avibactam + Gentamicin"),
        scientific = TRUE, digits = 3, cutoff = cutoff)

plotConfInt(maxR_B, color ="effect-size")

rsh <- fitSurface(caz_gent_kpcb2, marginalFit,
                  null_model = "hsa",
                  B.CP = 50, statistic = "both", parallel = FALSE)
summary(rsh)

rsb <- fitSurface(caz_gent_kpcb2, marginalFit, 
                  null_model = "bliss",
                  B.CP = 50, statistic = "both", parallel = FALSE)
summary(rsb)





```

<br>

-   The activity of combination ceftazidime/avibactam (4 to 1 ratio from commercial formulation) plus gentamicin was tested against ***Klebsiella pneumonia*****\_KPC_A strain** in 5 replicate experiments using the same methodology.
-   Results are shown in [@fig-11]**.**

```{r}
#| label: fig-11
#| fig-cap: "Effect of combined ceftazidime/avibactam and gentamicin effects on Tpos"

library(BIGL)
library(knitr)
library(rgl)
library(ggplot2)
library(broom)
library(kableExtra)
set.seed(12345)
cutoff <- 0.95
caz_gent_kpca2 <- read.csv("~/Desktop/ACUTEWEBSITE/datasets/caz_gent_kpca2.csv")
## Fitting marginal models, maximal fixed at 24 hours, minimal at 9.5 hours
marginalFit2 <- fitMarginals(caz_gent_kpca2, method = "optim",                 
                            fixed = c("m1" = 24, "m2" = 24, "b" = 9.5),
                            names = c("CTZ/AVI", "GENT"))
summary(marginalFit2)
## Plotting marginal model for ceftazidime and gentamicin, minimum constrained at 9 hrs and maximum contrastined at 24 hours
plot(marginalFit2) + ggtitle(paste("Ceftazidime/Avibactam + Gentamicin"))
rs2 <- fitSurface(caz_gent_kpca2, marginalFit2,
                 null_model = "bliss",
                 B.CP = 50, statistic = "none", parallel = FALSE)
summary(rs2)
plot(rs2, legend = FALSE, main = "")
view3d(0, -75)
rglwidget()


## mean R statistic evaluates how the test evaluates how the predicted response surface based on a specified null model differs from the observed one. If the null hypothesis is rejected, this test suggests that at least some dose combinations may exhibit synergistic or antagonistic behaviour. The meanR test is not designed to pinpoint which combinations produce these effects nor what type of deviating effect is present.
meanR_N2 <-fitSurface(caz_gent_kpca2, marginalFit2, statistic="meanR",CP=rs2$CP, B.B=20, parallel = FALSE)

# maxR test allows to evaluate presence of synergistic/antagonistic effects for each dose combination and as such provides a point-by-point classification.
maxR_N2 <- fitSurface(caz_gent_kpca2, marginalFit2,
                     statistic = "maxR", CP = rs2$CP, B.B = 20,
                     parallel = FALSE)
maxR_B2 <- fitSurface(caz_gent_kpca2, marginalFit2,
                     statistic = "maxR", CP = rs2$CP, B.B = 20,
                     parallel = FALSE)
maxR_both2 <- rbind(summary(maxR_N2$maxR)$totals,
                   summary(maxR_B2$maxR)$totals)

contour(maxR_B2,
         ## colorPalette = c("blue", "black", "black", "red"),
        main = paste0(" Ceftazidime/Avibactam + Gentamicin"),
        scientific = TRUE, digits = 3, cutoff = cutoff)

plotConfInt(maxR_B2, color ="effect-size")

rsh2 <- fitSurface(caz_gent_kpca2, marginalFit2,
                  null_model = "hsa",
                  B.CP = 50, statistic = "both", parallel = FALSE)
summary(rsh2)

rsb2 <- fitSurface(caz_gent_kpca2, marginalFit2, 
                  null_model = "bliss",
                  B.CP = 50, statistic = "both", parallel = FALSE)
summary(rsb2)





```

<br>

#### Ceftazidime/avibactam plus aztreonam

Results are shown in [@fig-12].

```{r}
#| label: fig-12
#| fig-cap: "Effect of combined ceftazidime/avibactam and gentamicin effects on Tpos"

library(BIGL)
library(knitr)
library(rgl)
library(ggplot2)
library(broom)
library(kableExtra)
set.seed(12345)
cutoff <- 0.95
caz_azt <- read.csv("~/Desktop/ACUTEWEBSITE/datasets/caz_avi_azt.csv")
## Fitting marginal models, maximal fixed at 24 hours, minimal at 9.5 hours
marginalFit3 <- fitMarginals(caz_azt, method = "optim",                 
                            fixed = c("m1" = 24, "m2" = 24, "b" = 9.5),
                            names = c("CTZ/AVI", "AZT"))
summary(marginalFit3)
## Plotting marginal model for ceftazidime/avibactam and aztroenam, minimum constrained at 9 hrs and maximum constrained at 24 hours
plot(marginalFit3) + ggtitle(paste("Ceftazidime/Avibactam + Aztreonam"))
rs3 <- fitSurface(caz_azt, marginalFit3,
                 null_model = "bliss",
                 B.CP = 50, statistic = "none", parallel = FALSE)
summary(rs3)
plot(rs3, legend = FALSE, main = "")
view3d(0, -75)
rglwidget()


rsh3 <- fitSurface(caz_azt, marginalFit3,
                  null_model = "hsa",
                  B.CP = 50, statistic = "both", parallel = FALSE)
summary(rsh3)

rsb3 <- fitSurface(caz_azt, marginalFit3, 
                  null_model = "bliss",
                  B.CP = 50, statistic = "both", parallel = FALSE)
summary(rsb3)


```
